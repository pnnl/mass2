#! /usr/unsupported/bin/perl
# -*- mode: cperl -*-
# -------------------------------------------------------------
# file: mkgrid.pl
# -------------------------------------------------------------
# -------------------------------------------------------------
# Battelle Memorial Institute
# Pacific Northwest Laboratory
# -------------------------------------------------------------
# -------------------------------------------------------------
# Created October 15, 2003 by William A. Perkins
# Last Change: Tue Jan  6 12:43:39 2004 by William A. Perkins <perk@leechong.pnl.gov>
# -------------------------------------------------------------

# RCS ID: $Id$

use strict;

# -------------------------------------------------------------
#  variable initialization
# -------------------------------------------------------------
my $program;
($program = $0) =~ s/.*\///;
my $usage = "usage: $program";


my $L = 5000.0;
my $B = 10.0;
my $SS = 0.5;
my $D = 2.0;
my $W = $B + 2*$D/$SS;
my $Z0 = 15.0;
my $dx = 5.0;
my $dy = 0.25;

my $pi = atan2(1.0,1.0)*4.0;
my $g = 9.81;

# -------------------------------------------------------------
# main program
# -------------------------------------------------------------

my $dhat;
my $d;
my $z = $Z0;
my $i;
my $j;

my $x;
my $y;
my $So;

printf("%10d %10d\n", $L/$dx + 1, $W/$dy + 1);

$i = 1;
for ($x = 0.0; $x <= $L; $x += $dx, $i += 1) {
  $d = 9.0/8.0 + 0.250*sin($pi*$x/500);
  $dhat = $pi/2000.0*cos($pi*$x/500);
  $So = (1 - (400*(10+4*$d))/($g*(10+2*$d)**3.0*$d**3.0))*$dhat +
    0.36*((10+2*$d*sqrt(5.0))**(4/3))/((10+2*$d)**(10/3)*$d**(10/3));
  if ($x > 0.0) {
    $z -= $So*$dx;
  } else {
    $z = $Z0;
  }
  # printf("%12.8e %12.8e %12.8e %12.8e\n", $x, $d, $So, $z);

  for ($y = 0.0, $j = 1; $y < $D/$SS; $y += $dy, $j++) {
    printf("%10d %10d %12.8e %12.8e %12.8e\n", $i, $j, $x/0.3048, $y/0.3048, ($D - $SS*$y + $z)/0.3048);
  }
  for (; $y < $B + $D/$SS; $y += $dy, $j++) {
    printf("%10d %10d %12.8e %12.8e %12.8e\n", $i, $j, $x/0.3048, $y/0.3048, $z/0.3048);
  }
  for (; $y <= $W; $y += $dy, $j++) {
    printf("%10d %10d %12.8e %12.8e %12.8e\n", $i, $j, $x/0.3048, $y/0.3048, ($SS*($y - $B - $D/$SS) + $z)/0.3048);
  }
}
